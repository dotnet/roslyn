# Branches that trigger a build on commit
trigger:
- main
- main-vs-deps
- release/*
- features/*
- demos/*

# Branches that trigger builds on PR
pr: none
# Temporarily disabling richnav job on PRs
# pr:
# - main
# - main-vs-deps
# - release/*
# - features/*
# - demos/*

jobs:
- job: RichCodeNav_Indexing
  variables:
    EnableRichCodeNavigation: true
  - template: /eng/common/templates/variables/pool-providers.yml
  pool:
    name: $(DncEngPublicBuildPool)
    demands: ImageOverride -equals windows.vs2022.amd64.open
  timeoutInMinutes: 200

  steps:
    - task: PowerShell@2
      displayName: Build
      inputs:
        filePath: eng/build.ps1
        arguments: -ci -restore -build -binaryLog -configuration Debug -prepareMachine

    - task: RichCodeNavIndexer@0
      displayName: RichCodeNav Upload
      inputs:
        languages: 'csharp'
        environment: production
        richNavLogOutputDirectory: $(Build.SourcesDirectory)/artifacts/bin
      continueOnError: true
      env:
        DOTNET_ROOT: $(Build.SourcesDirectory)/.dotnet
