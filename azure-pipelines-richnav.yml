# Run on master CI builds
trigger:
  branches:
    include:
    - master

# pr: none
pr:
- master # For temporary testing only

jobs:
- job: RichCodeNav_Indexing
  pool:
    name: NetCorePublic-Pool
    queue: BuildPool.Windows.10.Amd64.Open
  variables:
    EnableRichCodeNavigation: true
  timeoutInMinutes: 200

  steps:
    - script: eng/cibuild.cmd -configuration Debug -prepareMachine
      displayName: Build
      
    - task: UseDotNet@2
      displayName: 'Use .NET Core sdk'
      inputs:
        useGlobalJson: true

    - task: RichCodeNavIndexer@0
      displayName: RichCodeNav Upload
      inputs:
        languages: 'csharp'
        environment: production
        richNavLogOutputDirectory: $(Build.SourcesDirectory)/artifacts/bin
      continueOnError: true
