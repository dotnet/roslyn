# Shallow checkout sources on Unix with Windows line endings

steps:
  - checkout: none

  - script: |
      set -x
      git init
      git config --local checkout.workers 0
      git config --local fetch.parallel 0
      git remote add origin "$(Build.Repository.Uri)"
      git fetch --no-tags --no-auto-maintenance --depth=1 origin "$(Build.SourceVersion)"
      git checkout "$(Build.SourceVersion)"
      find . -name '*.cs' -exec awk 'BEGIN{RS="^$";ORS="";getline;gsub("\n","\r&");print>ARGV[1]}' {} \;
      find . -name '*.vb' -exec awk 'BEGIN{RS="^$";ORS="";getline;gsub("\n","\r&");print>ARGV[1]}' {} \;
    displayName: Shallow Checkout