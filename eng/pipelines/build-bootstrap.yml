# Build bootstrap 
parameters:
- name: toolset
  type: string
  default: ''

steps:
    - template: checkout-windows-task.yml

    - script: eng\make-bootstrap.cmd -ci -toolset ${{parameters.toolset}} -name "ci-bootstrap"
      displayName: Build Bootstrap Compiler

    - script: eng/test-build-correctness.cmd -configuration Release -enableDumps -bootstrapDir $(Build.SourcesDirectory)/artifacts/bootstrap/ci-bootstrap
      displayName: Build - Validate correctness

    - template: publish-logs.yml
      parameters:
        jobName: Correctness_Bootstrap_Build - ${{parameters.toolset}}
        configuration: Release

    - task: PublishBuildArtifacts@1
      displayName: Publish Bootstrap Compiler
      inputs:
        PathtoPublish: '$(Build.SourcesDirectory)\artifacts\bootstrap\ci-bootstrap'
        ArtifactName: 'Bootstrap Compiler - ${{parameters.toolset}}'
        publishLocation: Container

    - task: PublishBuildArtifacts@1
      displayName: Publish Artifact Packages
      inputs:
        PathtoPublish: '$(Build.SourcesDirectory)\artifacts\packages\Release\PreRelease'
        ArtifactName: 'Bootstrap Packages - ${{parameters.toolset}}'
        publishLocation: Container

    - task: PublishBuildArtifacts@1
      displayName: Publish VSIX Packages
      inputs:
        PathtoPublish: '$(Build.SourcesDirectory)\artifacts\VSSetup\Release\Installer'
        ArtifactName: 'Bootstrap VSIX - ${{parameters.bootstrapName}}'
        publishLocation: Container
