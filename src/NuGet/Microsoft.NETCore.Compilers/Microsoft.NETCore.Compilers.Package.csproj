<!-- Copyright (c)  Microsoft.  All Rights Reserved.  Licensed under the Apache License, Version 2.0.  See License.txt in the project root for license information. -->
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>netcoreapp2.0</TargetFramework>

    <IsPackable>true</IsPackable>
    <PackageId>Microsoft.NETCore.Compilers</PackageId>
    <IncludeBuildOutput>false</IncludeBuildOutput>
    <DevelopmentDependency>true</DevelopmentDependency>
    <PackageDescription>
      CoreCLR-compatible versions of the C# and VB compilers for use in MSBuild.
    </PackageDescription>
    <TargetsForTfmSpecificContentInPackage>$(TargetsForTfmSpecificContentInPackage);_GetFilesToPackage</TargetsForTfmSpecificContentInPackage>
  </PropertyGroup>

  <ItemGroup>
    <ProjectReference Include="..\..\Compilers\CSharp\csc\csc.csproj" PrivateAssets="all"/>
    <ProjectReference Include="..\..\Compilers\VisualBasic\vbc\vbc.csproj" PrivateAssets="all"/>
    <ProjectReference Include="..\..\Interactive\csi\csi.csproj" PrivateAssets="all"/>
    <ProjectReference Include="..\..\Compilers\Core\MSBuildTask\Microsoft.Build.Tasks.CodeAnalysis.csproj" PrivateAssets="all"/>
    <ProjectReference Include="..\..\Compilers\Server\VBCSCompiler\VBCSCompiler.csproj" PrivateAssets="all"/>
  </ItemGroup>

  <ItemGroup>
    <_ExplicitProjectReference Include="@(ProjectReference)" />
  </ItemGroup>

  <!-- Publish dependent projects before packaging. -->
  <Target Name="_PublishDependencies" BeforeTargets="Pack">
    <MSBuild Projects="@(_ExplicitProjectReference)" Targets="Publish" Properties="TargetFramework=$(TargetFramework)" BuildInParallel="true" />
  </Target>

  <Target Name="_GetFilesToPackage">
    <PropertyGroup>
      <_Dlls>$(ArtifactsConfigurationDir)Dlls\</_Dlls>
      <_Exes>$(ArtifactsConfigurationDir)Exes\</_Exes>
    </PropertyGroup>
    <ItemGroup>
      <_File Include="$(MSBuildProjectDirectory)\build\**\*.*" TargetDir="build" />
      <_File Include="$(MSBuildProjectDirectory)\tools\**\*.*" TargetDir="tools" />

      <!-- Targets and task files -->
      <File Include="$(_Dlls)Microsoft.Build.Tasks.CodeAnalysis\netcoreapp2.0\Microsoft.Build.Tasks.CodeAnalysis.dll" TargetDir="tools" />
      <File Include="$(_Dlls)Microsoft.Build.Tasks.CodeAnalysis\netcoreapp2.0\Microsoft.Managed.Core.targets" TargetDir="tools" />
      <File Include="$(_Dlls)Microsoft.Build.Tasks.CodeAnalysis\netcoreapp2.0\Microsoft.CSharp.Core.targets" TargetDir="tools" />
      <File Include="$(_Dlls)Microsoft.Build.Tasks.CodeAnalysis\netcoreapp2.0\Microsoft.VisualBasic.Core.targets" TargetDir="tools" />
      <File Include="$(_Dlls)Microsoft.Build.Tasks.CodeAnalysis\netcoreapp2.0\publish\runtimes\**\*.*" TargetDir="tools\runtimes" />

      <!-- Compiler exe files -->
      <File Include="$(_Dlls)Microsoft.CodeAnalysis\Microsoft.CodeAnalysis.dll" TargetDir="tools\bincore" />
      <File Include="$(_Dlls)Microsoft.CodeAnalysis.CSharp\Microsoft.CodeAnalysis.CSharp.dll" TargetDir="tools\bincore" />
      <File Include="$(_Exes)csc\netcoreapp2.0\publish\csc.dll" TargetDir="tools\bincore" />
      <File Include="$(_Exes)csc\netcoreapp2.0\publish\csc.deps.json" TargetDir="tools\bincore" />
      <File Include="$(_Exes)csc\netcoreapp2.0\publish\csc.runtimeconfig.json" TargetDir="tools\bincore" />
      <File Include="$(_Dlls)Microsoft.CodeAnalysis.VisualBasic\Microsoft.CodeAnalysis.VisualBasic.dll" TargetDir="tools\bincore" />
      <File Include="$(_Exes)vbc\netcoreapp2.0\publish\vbc.dll" TargetDir="tools\bincore" />
      <File Include="$(_Exes)vbc\netcoreapp2.0\publish\vbc.deps.json" TargetDir="tools\bincore" />
      <File Include="$(_Exes)vbc\netcoreapp2.0\publish\vbc.runtimeconfig.json" TargetDir="tools\bincore" />
      <File Include="$(_Exes)VBCSCompiler\netcoreapp2.0\publish\VBCSCompiler.dll" TargetDir="tools\bincore" />
      <File Include="$(_Exes)VBCSCompiler\netcoreapp2.0\publish\VBCSCompiler.deps.json" TargetDir="tools\bincore" />
      <File Include="$(_Exes)VBCSCompiler\netcoreapp2.0\publish\VBCSCompiler.runtimeconfig.json" TargetDir="tools\bincore" />

      <!-- Satellite assemblies -->
      <File Include="$(_Dlls)Microsoft.Build.Tasks.CodeAnalysis\**\Microsoft.Build.Tasks.CodeAnalysis.resources.dll" TargetDir="tools" />
      <File Include="$(_Dlls)Microsoft.CodeAnalysis\**\Microsoft.CodeAnalysis.resources.dll" TargetDir="tools/bincore" />
      <File Include="$(_Dlls)Microsoft.CodeAnalysis.CSharp\**\Microsoft.CodeAnalysis.CSharp.resources.dll" TargetDir="tools/bincore" />
      <File Include="$(_Dlls)Microsoft.CodeAnalysis.VisualBasic\**\Microsoft.CodeAnalysis.VisualBasic.resources.dll" TargetDir="tools/bincore" />

      <!-- References that are either not in the target framework or are a higher version -->
      <!-- N.B.: The backslashes below cannot be replaced with forward slashes.
         https://github.com/NuGet/Home/issues/3584 -->
      <File Include="$(_Exes)csc\netcoreapp2.0\publish\System.*.dll" TargetDir="tools\bincore" />
      <File Include="$(_Exes)csc\netcoreapp2.0\publish\runtimes\**" TargetDir="tools\bincore\runtimes" />

      <TfmSpecificPackageFile Include="@(_File)" PackagePath="%(_File.TargetDir)/%(_File.RecursiveDir)%(_File.FileName)%(_File.Extension)" />
    </ItemGroup>
  </Target>
</Project>