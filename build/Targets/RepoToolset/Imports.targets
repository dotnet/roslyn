<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright (c)  Microsoft.  All Rights Reserved.  Licensed under the Apache License, Version 2.0.  See License.txt in the project root for license information. -->
<Project>

  <PropertyGroup>
    <MSBuildAllProjects>$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>
  </PropertyGroup>

  <PropertyGroup>
    <IsShipping Condition="'$(IsShipping)' == ''">true</IsShipping>
  </PropertyGroup>

  <!--
    Set PackageOutputPath based on the IsShipping flag set by projects.
    This distinction allows signing and publishing tools to determine which assets to sign/publish and which to ignore.

    Unless specified owtherwise project is assumed to produce binaries/package that ship.
    Test projects automatically set IsShipping to false.
  -->
  <PropertyGroup>
    <IsShipping Condition="'$(IsShipping)' == ''">true</IsShipping>

    <PackageOutputPath Condition="'$(IsShipping)' == 'true'">$(ArtifactsShippingPackagesDir)</PackageOutputPath>
    <PackageOutputPath Condition="'$(IsShipping)' != 'true'">$(ArtifactsNonShippingPackagesDir)</PackageOutputPath>
  </PropertyGroup>

  <Import Project="StrongName.targets"/>
  <Import Project="GenerateInternalsVisibleTo.targets" />
  <Import Project="Workarounds.targets"/>
  <Import Project="RepositoryInfo.targets"/>
  <Import Project="Version.targets"/>

  <Import Project="Localization.targets" />
  <Import Project="VisualStudio.targets" Condition="'$(UsingToolVSSDK)' == 'true' and '$(DesignTimeBuild)' != 'true' and '$(BuildingForLiveUnitTesting)' != 'true' and '$(MSBuildRuntimeType)' != 'Core'"/>
  <Import Project="OptimizationData.targets"/>
  <Import Project="SymStore.targets"/>

  <UsingTask TaskName="Microsoft.DotNet.Arcade.Sdk.LocateDotNet" AssemblyFile="$(RoslynToolsBuildTasksAssembly)" />

  <Target Name="InitializeDotNetToolPath" Condition="'$(DotNetTool)' == ''">
    <!-- Respect environment variable for the .NET install directory if set; otherwise, use the repo default location -->
    <PropertyGroup>
      <_DotNetRoot>$(DOTNET_INSTALL_DIR)</_DotNetRoot>
      <_DotNetRoot Condition="'$(_DotNetRoot)' == ''">$(RepoRoot).dotnet\</_DotNetRoot>
      <_DotNetRoot Condition="!HasTrailingSlash('$(_DotNetRoot)')">$(_DotNetRoot)\</_DotNetRoot>

      <DotNetTool Condition="'$(OS)' == 'Windows_NT'">$(_DotNetRoot)dotnet.exe</DotNetTool>
      <DotNetTool Condition="'$(OS)' != 'Windows_NT'">$(_DotNetRoot)dotnet</DotNetTool>
    </PropertyGroup>

    <!-- Find dotnet on PATHs -->
    <Microsoft.DotNet.Arcade.Sdk.LocateDotNet RepositoryRoot="$(RepoRoot)" Condition="!Exists('$(DotNetTool)')">
      <Output TaskParameter="DotNetPath" PropertyName="DotNetTool" />
    </Microsoft.DotNet.Arcade.Sdk.LocateDotNet>
  </Target>

</Project>